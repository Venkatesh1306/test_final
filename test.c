/*
 * File:   test.c
 * Author: Green2
 *
 * Created on 9 April, 2024, 11:13 AM
 * developed for testing the inputs
 */

#include "testhead.h"
// recived packet frame
unsigned char ModbusTcpRxBuftest[INR_SIZE][100] = {
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x06, 0x00, 0x03, 0x03, 0x04},
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x03, 0x00, 0x09, 0x00, 0x03},
    {0x11, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x10, 0x00, 0x06, 0x00, 0x02, 0x04, 0x03, 0x04, 0x3c, 0x7e},
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x09, 0x00, 0x07, 0x00, 0x06},
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x03, 0x00, 0x28, 0x00, 0x03},
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x06, 0x00, 0x27, 0x00, 0x06},
    {0x0e, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x10, 0x00, 0x30, 0x00, 0x01, 0x00, 0x03},
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x06, 0x00, 0x09, 0xff, 0xff},
    {0x13, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x10, 0x00, 0x0C, 0x00, 0x03, 0x06, 0xff, 0xff, 0x06, 0x05, 0x06, 0x05},
    {0x13, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x10, 0x00, 0x0C, 0x00, 0x03, 0x06, 0x00, 0x06, 0x06, 0x05, 0x06, 0x05},
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x01, 0x00, 0x03, 0x00, 0x09}};

unsigned char Test_TXtest[INR_SIZE][100] = {
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x06, 0x00, 0x03, 0x03, 0x04},
    {0xf, 0x00, 0x01, 0x00, 0x02, 0x00, 0x09, 0x03, 0x03, 0x6, 0x3c, 0x7e, 0x03, 0x02, 0xFF, 0xFF},
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x10, 0x00, 0x06, 0x00, 0x02},
    {0x09, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x89, 0x01},
    {0x09, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x83, 0x02},
    {0x09, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x86, 0x02},
    {0x09, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x90, 0x02},
    {0x09, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x86, 0x03},
    {0x09, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x90, 0x03},
    {0x0c, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x10, 0x00, 0x0C, 0x00, 0x03},
    {0x0b, 0x00, 0x01, 0x00, 0x02, 0x00, 0x06, 0x03, 0x01, 0x02, 0xE0, 0x01}};
// Data register
unsigned short int Dataregister[100] = {0xff00, 0x00ff, 0x0000, 0xFFFF, 0x00ff, 0x00ff, 0x00ff, 0xff00, 0x3A2B, 0x3c7e, 0x0302, 0xFFFF, 0x1123, 0x1321, 0x3A2B, 0x3c7e, 0x0065, 0x2217, 0x1123, 0x1321, 0x3A2B, 0x3c7e, 0x0065, 0x2217, 0x1123, 0x1321, 0x3A2B, 0x3c7e, 0x0065, 0x2217, 0x1123, 0x1321, 0x3A2B, 0x3c7e};

/*
main function for testing
generates the expected frame by cosidering the ModbusTcpRxBuf
stores the frame in Test_TX
finally checks the expected and actual outputs are same
expected -- Test_Tx
*/
int main()
{
   int j;

   for (inc = 0; inc < INR_SIZE; inc++)
   {

      for (j = 0; j <= ModbusTcpRxBuftest[inc][0]; j++)
      {
         ModbusTcpRxBuf[j] = ModbusTcpRxBuftest[inc][j + 1];
      }
      for (j = 0; j <= Test_TXtest[inc][0]; j++)
      {
         Test_TX[j] = Test_TXtest[inc][j + 1];
      }

      frame_function(&ModbusTcpRxBuf[0], &Dataregister[0], &parse, &ModbusTcpTxBuf[0], &ModbusTxLength); // main call function
      Test_ing(ModbusTcpTxBuf, Test_TX);                                                                 // comparing expected and actual frame
      printfunction();                                                                                   // printing the output
   }
}